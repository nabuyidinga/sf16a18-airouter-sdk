#!/bin/sh

[ -d "/etc/board.d/" -a ! -f "/etc/board.json" ] && {
	for a in `ls /etc/board.d/*`; do
		[ -x $a ] || continue;
		$(. $a)
	done
}

[ -f "/etc/board.json" ] || return 1
[ -f "/etc/config/network" ] || {
	touch /etc/config/network
	/bin/config_generate
}

[ -f "/usr/sbin/auto_ota" ] && {
	test=`grep "0\ 2\ \*\ \*\ \*\ /usr/sbin/auto_ota"  /etc/crontabs/admin`
	if [ -n "$test" ] ; then
		a=`head -20 /dev/urandom | cksum | cut -f1 -d" "`
		b=$(( $a % 5 ))
		b=$(( $b + 1 ))
		c=$(( $a % 59 ))
		echo $c $b
		sed -i "/auto_ota/d" /etc/crontabs/admin
		echo "$c $b * * * /usr/sbin/auto_ota" >> /etc/crontabs/admin
		echo  "admin" > /etc/crontabs/cron.update
	fi
}
